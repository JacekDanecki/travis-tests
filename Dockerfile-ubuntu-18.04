FROM docker.io/ubuntu:18.04
MAINTAINER Jacek Danecki <jacek.danecki@intel.com>

COPY neo /root/neo
RUN apt-get -y update; apt-get install -y --allow-unauthenticated cmake g++ git wget pkg-config ninja-build
RUN cd /root; git clone https://github.com/intel/gmmlib gmmlib ;\
    git clone --depth 2 https://github.com/KhronosGroup/OpenCL-Headers khronos ; \
    cd khronos; git checkout -b build e986688daf750633898dfd3994e14a9e618f2aa5 ; cd .. ; \
    cd neo/scripts/igc ; ./prepare.sh ; cd ../../.. ; \
    mkdir build; cd build ; cmake -G Ninja -DBUILD_TYPE=Release -DCMAKE_BUILD_TYPE=Release \
    -DDO_NOT_RUN_AUB_TESTS=1 -DDONT_CARE_OF_VIRTUALS=1 ../neo ; ninja -j `nproc`
CMD ["/bin/bash"]
